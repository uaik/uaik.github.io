# -------------------------------------------------------------------------------------------------------------------- #
# OS:               Fedora
# ID:               SRV-00-143965-038-01
# Type:             Server
# -------------------------------------------------------------------------------------------------------------------- #

# -------------------------------------------------------------------------------------------------------------------- #
# Installation methods and sources.
# -------------------------------------------------------------------------------------------------------------------- #

mediacheck

repo --name="ks-fedora-base" --baseurl="https://mirror.yandex.ru/fedora/linux/releases/$releasever/Everything/$basearch/os/"
repo --name="ks-fedora-updates" --baseurl="https://mirror.yandex.ru/fedora/linux/updates/$releasever/Everything/$basearch/" --cost=0

url --url="https://mirror.yandex.ru/fedora/linux/releases/$releasever/Everything/$basearch/os/"

# -------------------------------------------------------------------------------------------------------------------- #
# Network configuration.
# -------------------------------------------------------------------------------------------------------------------- #

firewall --enabled --service="mdns"
network --bootproto="dhcp" --device="link" --hostname="localhost.localdomain" --activate

# -------------------------------------------------------------------------------------------------------------------- #
# Console and environment.
# -------------------------------------------------------------------------------------------------------------------- #

keyboard us
lang en_US.UTF-8
services --enabled="sshd,NetworkManager,chronyd"
skipx
timesource --ntp-server="0.pool.ntp.org,1.pool.ntp.org,2.pool.ntp.org,3.pool.ntp.org"
timezone --utc Etc/UTC

# -------------------------------------------------------------------------------------------------------------------- #
# Users, groups and authentication.
# -------------------------------------------------------------------------------------------------------------------- #

# auth --enableshadow --passalgo="sha512"
selinux --permissive
rootpw --iscrypted "$6$osovQ16QYPir90fB$mD3vZ5EgWxAEkMBEbge8qFHivP29/MJUY0TOOkZ/DCeMLuFOEvjLJS492QRyW0JVeRcUIDwRF912u.78EZNBF."
user --iscrypted --name="user-0000" --password="$6$wHsDgAvq3XOUumwh$qL5OTBQTiODcN68t1DE4y70TvPp5I8gl8o7VKyDCNmQz4UpyX5DINKQAN9xzk9kuM6Bm4FjiRcv1TrXrfE6UK1"

# -------------------------------------------------------------------------------------------------------------------- #
# Installation environment.
# -------------------------------------------------------------------------------------------------------------------- #

text
eula --agreed

# -------------------------------------------------------------------------------------------------------------------- #
# After installation.
# -------------------------------------------------------------------------------------------------------------------- #

firstboot --disable
shutdown

# -------------------------------------------------------------------------------------------------------------------- #
# Storage and partitioning.
# -------------------------------------------------------------------------------------------------------------------- #

bootloader --location="mbr" --boot-drive="disk/by-id/wwn-0x50025388a08be76b"
clearpart --drives="disk/by-id/wwn-0x50025388a08be76b" --all --initlabel --disklabel="gpt"
ignoredisk --only-use="disk/by-id/wwn-0x50025388a08be76b"

part biosboot --fstype="biosboot" --ondisk="disk/by-id/wwn-0x50025388a08be76b" --size=1 --label="id_bios"
part /boot --fstype="xfs" --ondisk="disk/by-id/wwn-0x50025388a08be76b" --size="4096" --label="id_boot"
part / --fstype="xfs" --ondisk="disk/by-id/wwn-0x50025388a08be76b" --size="65536" --label="id_root"
part swap --fstype="swap" --ondisk="disk/by-id/wwn-0x50025388a08be76b" --size="32768"
part /var/log --fstype="xfs" --ondisk="disk/by-id/wwn-0x50025388a08be76b" --size="16384" --label="id_log"
part /tmp --fstype="xfs" --ondisk="disk/by-id/wwn-0x50025388a08be76b" --size="16384" --label="id_tmp"
part /home --fstype="xfs" --ondisk="disk/by-id/wwn-0x50025388a08be76b" --size=1 --grow --label="id_home"

zerombr

# -------------------------------------------------------------------------------------------------------------------- #
# Packages.
# -------------------------------------------------------------------------------------------------------------------- #

%packages
@core
@standard
@hardware-support
@server-hardware-support
@networkmanager-submodules
chrony
curl
glibc-all-langpacks
htop
mc
vim
zsh
%end

# -------------------------------------------------------------------------------------------------------------------- #
# Post-installation script.
# -------------------------------------------------------------------------------------------------------------------- #

%post
# Setup systemd to boot to the right runlevel.
echo -n "Setting default runlevel to multiuser text mode..."
mv -f /etc/systemd/system/default.target /etc/systemd/system/default.target.ks-backup
ln -s /lib/systemd/system/multi-user.target /etc/systemd/system/default.target
echo .

# Get setup script.
curl -o /root/uaik.setup.sh 'https://uaik.github.io/unix.setup.sh'
%end
