#!/usr/bin/bash
#
# "First steps" setup script.
#
# @package    Bash
# @author     Kitsune Solar <mail@kitsune.solar>
# @copyright  2023 Library Online
# @license    MIT
# @version    0.1.0
# @link
# -------------------------------------------------------------------------------------------------------------------- #

(( EUID != 0 )) && { echo >&2 'This script should be run as root!'; exit 1; }

# -------------------------------------------------------------------------------------------------------------------- #
# INITIALIZATION.
# -------------------------------------------------------------------------------------------------------------------- #

init() {
  # Apps.
  chsh="$( command -v chsh )"
  chpasswd="$( command -v chpasswd )"
  useradd="$( command -v useradd )"
  usermod="$( command -v usermod )"

  # Run.
  user_root       \
    && user_0001  \
    && user_0000
}

# -------------------------------------------------------------------------------------------------------------------- #
# USER ROOT.
# -------------------------------------------------------------------------------------------------------------------- #

user_root() {
  local name='root'
  local password

  echo "--- [${name^^}] Changing password for '${name^^}'..."
  read -rp 'Password: ' password </dev/tty
  echo "${name}:${password}" | ${chpasswd}

  echo "--- [${name^^}] Changing shell for '${name^^}'..."
  ${chsh} -s '/bin/zsh' "${name}"
}

# -------------------------------------------------------------------------------------------------------------------- #
# USER-0001.
# -------------------------------------------------------------------------------------------------------------------- #

user_0001() {
  local name='user-0001'
  local password

  echo "--- [${name^^}] Adding user '${name^^}'..."
  ${useradd} -mc "${name^^}" "${name}"

  echo "--- [${name^^}] Changing password for '${name^^}'..."
  read -rp "Password: " password </dev/tty
  echo "${name}:${password}" | ${chpasswd}

  echo "--- [${name^^}] Changing shell for '${name^^}'..."
  ${chsh} -s '/bin/zsh' "${name}"
}

# -------------------------------------------------------------------------------------------------------------------- #
# USER-0000.
# -------------------------------------------------------------------------------------------------------------------- #

user_0000() {
  local name='user-0000'

  echo "--- [${name^^}] Locking default user '${name^^}'..."
  ${usermod} -L "${name}"
}

# -------------------------------------------------------------------------------------------------------------------- #
# -------------------------------------------------< RUNNING SCRIPT >------------------------------------------------- #
# -------------------------------------------------------------------------------------------------------------------- #

init "$@"; exit 0
